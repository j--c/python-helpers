#!/bin/bash

project_name=$1

function install_flask_packages(){
    touch install.log

    if [ $testing_method = "1" ]; then
        pip install behave > "install.log"
    fi
}

function write_gitignore(){
    touch .gitignore
    echo "# Byte-compiled / optimized / DLL files" >> .gitignore
    echo "__pycache__/" >> .gitignore
    echo "*.py[cod]" >> .gitignore
    echo "*.py.class" >> .gitignore
    echo "" >> .gitignore
    echo "# Virtual environment" >> .gitignore
    echo "venv/" >> .gitignore
    echo "" >> .gitignore
    echo "# Migrations / Alembic" >> .gitignore
    echo "migrations/" >> .gitignore
    echo "" >> .gitignore
    echo "# Databases" >> .gitignore
    echo "*.db" >> .gitignore
}

function create_unittest(){
    tst_dir='test'
    init_file='__init__.py'
    mkdir -p $tst_dir/$project_name
    touch $tst_dir/$init_file
    touch $tst_dir/$project_name/$init_file
}

function create_bdd(){
    features_dir='features'
    steps_dir='steps'
    mkdir -p $features_dir/$steps_dir
}

function create_src(){
    src_dir='src'
    init_file='__init__.py'
    mkdir -p $src_dir/$project_name
    touch $src_dir/$init_file
    touch $src_dir/$project_name/$init_file
}

function create_basic_files(){
    create_src
    if [ $testing_method = "1" ]; then
        create_bdd
    elif [ $testing_method = "2" ]; then
        create_unittest
    fi
}

function get_testing_method(){
    echo ""
    echo "---------------------"
    echo "Enter testing method:"
    echo "---------------------"
    echo "1.) BDD"
    echo "2.) Unittest"
    echo "---------------------"
    read -n 1 testing_method
    echo ""
    echo ""
}

if [ -z "$project_name" ]; then
    echo "Project name required!"
else
    get_testing_method

    if [ $testing_method = "1" ] || [ $testing_method = "2" ]; then


        echo "Creating project directory..."
        mkdir $project_name
        cd $project_name

        echo "Creating virtual environment..."
        python3 -m venv venv
        source venv/bin/activate

        echo "Installing flask packages..."
        install_flask_packages

        echo "Writing .gitignore..."
        write_gitignore

        echo "Creating git repo..."
        git init -b main

        echo "Creating basic files..."
        create_basic_files

    else
        echo ""
        echo "Invalid testing method entered!  Enter the number 1 or 2."
    fi
fi

